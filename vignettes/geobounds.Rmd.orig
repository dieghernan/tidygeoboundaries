---
title: "geobounds: Accessing Global Administrative Boundary Data in R"
bibliography: REFERENCES.bib
link-citations: yes
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{geobounds: Accessing Global Administrative Boundary Data in R}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- geobounds.Rmd is generated from geobounds.Rmd.orig. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  tidy = "styler",
  dev = "ragg_png",
  dpi = 150,
  fig.path = "./",
  out.width = "100%"
)

knitr::knit_hooks$set(crop = knitr::hook_pdfcrop)
```

[**Attribution**](https://www.geoboundaries.org/index.html#usage) **is required
when using geoBoundaries.**

## Introduction

The **geobounds** package provides a straightforward interface for downloading
and working with global political and administrative boundary data from the
[geoBoundaries](https://www.geoboundaries.org/) project [@geoboundaries].

These datasets are openly licensed ([CC BY
4.0](https://creativecommons.org/licenses/by/4.0/)) and cover countries
worldwide across multiple administrative levels. With **geobounds**, you can
easily fetch boundary geometries as **sf** objects, explore metadata, cache
datasets locally, and seamlessly integrate the boundaries into your spatial
workflows.

## Understanding the data

The geoBoundaries database undergoes a rigorous quality assurance process,
including manual review and hand-digitization of physical maps where necessary.
Its primary goal is to provide the highest possible level of spatial accuracy
for scientific and academic applications.

This precision comes at a cost: some files can be quite large and may take
longer to download. For visualization or general mapping purposes, we recommend
using the simplified datasets available by setting `simplified = TRUE`.

```{r norway, fig.cap='Comparison between full vs. simplified map.', crop=TRUE}
library(geobounds)
library(ggplot2)
library(dplyr)

# Different resolutions
norway <- gb_get_adm0("NOR") %>%
  mutate(res = "Full resolution")
print(object.size(norway), units = "Mb")

norway_simp <- gb_get_adm0(country = "NOR", simplified = TRUE) %>%
  mutate(res = "Simplified")
print(object.size(norway_simp), units = "Mb")

norway_all <- bind_rows(norway, norway_simp)

# Plot ggplot2
ggplot(norway_all) +
  geom_sf(fill = "#BA0C2F", color = "#00205B") +
  facet_wrap(vars(res)) +
  theme_minimal() +
  labs(caption = "Source: www.geoboundaries.org")
```

### Individual country files

The geoBoundaries API provides [individual country
files](https://www.geoboundaries.org/countryDownloads.html), whose aim is to
represent every nation "as they would represent themselves", with no special
identification of disputed areas.

The download of this data is implemented in `gb_get()` and the `gb_get_adm`
family of functions. It is not guaranteed that borders align perfectly or that
there are no gaps between countries. Additionally, these files do not include a
special identification of disputed areas.

```{r intersect, fig.cap="Map showing overlapping in disputed area: Kashmir."}
india_pak <- gb_get_adm0(c("India", "Pakistan"))

# Disputed area: Kashmir
ggplot(india_pak) +
  geom_sf(aes(fill = shapeName), alpha = 0.5) +
  scale_fill_manual(values = c("#FF671F", "#00401A")) +
  labs(
    fill = "Country",
    title = "Map of India & Pakistan",
    subtitle = "Note overlapping in Kashmir region",
    caption = "Source: www.geoboundaries.org"
  )
```

Note that individual data files are governed by the license or licenses
identified within the metadata for each respective boundary.

```{r meta}
gb_get_meta(c("India", "Pakistan"), adm_lvl = "ADM0") %>%
  select(boundaryName, boundaryLicense, boundarySource)

```


### Composite files

If you would prefer data that explicitly includes disputed areas, please use
`gb_get_cgaz()`. This function downloads global composite datasets for
administrative boundaries, also known as CGAZ (Comprehensive Global
Administrative Zones). There are three important distinctions between CGAZ and
individual country downloads:

1.  Extensive simplification is performed to ensure that file sizes are small
    enough to be used in most traditional desktop software.

2.  Disputed areas are removed and replaced with polygons following US
    Department of State definitions.
 
3.  Gaps between borders have been filled.

```{r cgaz, fig.cap="Map showing no overlapping in Kashmir, provided by CGAZ."}
cgaz_india_pak <- gb_get_cgaz(c("India", "Pakistan"))

ggplot(cgaz_india_pak) +
  geom_sf(aes(fill = shapeName), alpha = 0.5) +
  scale_fill_manual(values = c("#FF671F", "#00401A")) +
  labs(
    fill = "Country",
    title = "Map of India & Pakistan",
    subtitle = "CGAZ does not overlap",
    caption = "Source: www.geoboundaries.org"
  )
```

## Caching and performance

The package provides a built-in mechanism to cache files locally so that
repeated downloads for the same country/level will use the cached version. For
example:

```{r include = FALSE}
# Internal to not mess the vignette

getcache <- gb_detect_cache_dir()

gb_set_cache_dir(tempdir(), quiet = TRUE)
```

```{r, message=TRUE}
# Current folder
current <- gb_detect_cache_dir()

current

# Change to new
newdir <- file.path(tempdir(), "/geoboundvignette")
gb_set_cache_dir(newdir)

# Download
example <- gb_get_adm0("Vatican City", quiet = FALSE)

# Restore cache dir
gb_set_cache_dir(current)

current == gb_detect_cache_dir()
```

```{r include = FALSE}
# Restore
gb_set_cache_dir(getcache)
```

Specific cache directories on each function call can be set using the
`cache_dir` argument of each function.

## Use in spatial analysis pipelines

Because the boundaries are returned as **sf** objects, you can easily use them
in combination with other spatial data:

-   Clip raster data to administrative units
-   Compute zonal statistics
-   Create choropleth maps
-   Perform spatial joins with survey or tabular data

In this example we would create a choropleth map using the meta data of the
individual files and the boundaries data of CGAZ:

```{r choro, fig.cap="World Bank Income Group: Latin America and the Caribbean "}
# Metadata

latam_meta <- gb_get_meta(adm_lvl = "ADM0") %>%
  select(boundaryISO, boundaryName, Continent, worldBankIncomeGroup) %>%
  filter(Continent == "Latin America and the Caribbean") %>%
  glimpse()

# Adjust factors
latam_meta$income_factor <- factor(latam_meta$worldBankIncomeGroup,
  levels = c(
    "High-income Countries",
    "Upper-middle-income Countries",
    "Lower-middle-income Countries",
    "Low-income Countries"
  )
)

# Get the shapes from CGAZ
latam_sf <- gb_get_cgaz(adm_lvl = "ADM0") %>%
  inner_join(latam_meta,
    by =
      c("shapeGroup" = "boundaryISO")
  )

ggplot(latam_sf) +
  geom_sf(aes(fill = income_factor)) +
  scale_fill_brewer(palette = "Greens", direction = -1) +
  guides(fill = guide_legend(position = "bottom", nrow = 2)) +
  coord_sf(
      crs = "+proj=laea +lon_0=-75 +lat_0=-15"
  ) +
  labs(
    title = "World Bank Income Group",
    subtitle = "Latin America and the Caribbean",
    fill = "",
    caption = "Source: www.geoboundaries.org"
  )
```

## Summary

The **geobounds** package makes it easy to fetch, manage and visualize
administrative boundary data worldwide in a reproducible and efficient way.
Whether you're doing mapping, spatial analysis, survey integration or geospatial
modelling, it gives you a high-quality boundary dataset with minimal overhead.

## References
